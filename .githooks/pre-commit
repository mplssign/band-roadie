#!/bin/bash
#
# Pre-commit hook: Auto-update project structure documentation
#
# This hook runs the structure generator and stages the output file
# if it has changed.
#

set -e

# Get project root (where .git is)
PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT"

# Path to the structure file
STRUCTURE_FILE="docs/PROJECT_STRUCTURE.md"

# Check if Node.js is available
if ! command -v node &> /dev/null; then
    # Skip silently if Node.js isn't available
    exit 0
fi

# Run the generator
node scripts/gen_structure.js 2>/dev/null || true

# If the structure file exists and has changes, stage it
if [ -f "$STRUCTURE_FILE" ]; then
    # Check if file has unstaged changes
    if ! git diff --quiet "$STRUCTURE_FILE" 2>/dev/null; then
        git add "$STRUCTURE_FILE"
        echo "ğŸ“ Updated and staged $STRUCTURE_FILE"
    fi
fi

exit 0
